<section class="dash-root" *ngIf="!loading(); else skel">
  <header class="dash-header container">
    <a class="brand" routerLink="/" aria-label="Inicio NutriTrack">
      <span class="brand-name">NutriTrack</span>
    </a>

    <nav class="quick-links">
      <a routerLink="/profile" class="btn btn-ghost">
        <lucide-icon [img]="SettingsIcon"></lucide-icon>
        Configuraciones
      </a>
      <a routerLink="/goals" class="btn btn-chip">
        <lucide-icon [img]="TargetIcon"></lucide-icon> Metas
      </a>
      <a routerLink="/alimentation" class="btn btn-chip">
        <lucide-icon [img]="UtensilsCrossedIcon"></lucide-icon> Alimentación
      </a>
      <a routerLink="/water" class="btn btn-chip">
        <lucide-icon [img]="DropletsIcon"></lucide-icon> Agua
      </a>
    </nav>
  </header>

  <div class="container grid">
    <!-- Resumen -->
    <section class="card overview glow">
      <h2 class="title">Resumen y recomendaciones</h2>

      <div class="tags">
        <span class="tag">{{ sex()==='MALE' ? 'Hombre' : 'Mujer' }}</span>
        <span class="tag">Actividad:
          {{ activity()==='sedentary' ? 'Sedentario' : activity()==='moderate' ? 'Activo moderado' : 'Muy activo' }}
        </span>
        <span class="tag">Dieta:
          {{ diet()==='low_carb' ? 'Baja en carbohidratos' : diet()==='surplus' ? 'Superávit' : 'Déficit' }}
        </span>
      </div>

      <div class="kpis" align="center">
        <div class="kpi kpi--imc">
          <div class="k" ><lucide-icon [img]="HeartPulseIcon"></lucide-icon> IMC</div>
          <div class="v xl">{{ bmi() ?? '—' }}</div>
          <div class="hint">{{ bmiLabel() }}</div>
        </div>

        <div class="kpi kpi--kcal" align="center">
          <div class="k"><lucide-icon [img]="UtensilsCrossedIcon"></lucide-icon> Calorías recomendadas</div>
          <div class="v">{{ recKcal() ?? '—' }}<span class="unit">kcal/día</span></div>
          <div class="hint">Según sexo, edad, talla, peso y objetivo</div>
        </div>

        <!-- NUEVO: KPI de alimentación (progreso) -->
        <div class="kpi kpi--food" align="center">
          <div class="k"><lucide-icon [img]="UtensilsCrossedIcon"></lucide-icon> Alimentación (hoy)</div>
          <div class="v">
            {{ todayKcal() | number:'1.0-0' }}
            <span class="unit">/ {{ recKcal() ?? 0 }} kcal</span>
          </div>
          <div class="meter" align="left"><div class="bar" [style.width.%]="foodPct()"></div></div>
          <div class="hint">Progreso diario de calorías</div>
        </div>

        <div class="kpi kpi--water" align="center">
          <div class="k"><lucide-icon [img]="DropletsIcon"></lucide-icon> Agua recomendada</div>
          <div class="v">{{ recWater() ?? '—' }}<span class="unit">ml/día</span></div>
          <div class="meter" align="left"><div class="bar" [style.width.%]="waterPct()"></div></div>
          <div class="hint">Hoy: {{ waterMl() }} ml</div>
        </div>

        <div class="kpi kpi--goals" align="center">
          <div class="k"><lucide-icon [img]="TargetIcon"></lucide-icon> Metas activas</div>
          <div class="v">{{ goalsCount() }}</div>
          <a routerLink="/goals" class="more">Ver metas <lucide-icon [img]="ChevronRightIcon"></lucide-icon></a>
        </div>

        <!-- KPI/atajo: Prácticas saludables -->
        <a routerLink="/practices" class="kpi kpi--link kpi--practices" align="center">
          <div class="k">
            <lucide-icon [img]="HeartPulseIcon"></lucide-icon>
            Prácticas saludables
          </div>
          <div class="v sm">Hábitos y bienestar</div>
          <div class="hint">Sueño, pasos, pausas activas…</div>
          <span class="more">Ir a prácticas <lucide-icon [img]="ChevronRightIcon"></lucide-icon></span>
        </a>

      </div>
    </section>

    <!-- Tarjetas de acceso rápido -->
    <section class="grid cards">
      <a routerLink="/goals" class="card entry lift">
        <div class="head"><lucide-icon [img]="TargetIcon"></lucide-icon> Módulo 2: Metas</div>
        <ul class="mini">
          <li *ngFor="let g of goalsSample()">{{ g.title }}</li>
          <li *ngIf="goalsSample().length === 0" class="hint">Aún no tienes metas</li>
        </ul>
        <span class="cta">Ir a metas</span>
      </a>

      <a routerLink="/alimentation" class="card entry lift">
        <div class="head"><lucide-icon [img]="UtensilsCrossedIcon"></lucide-icon> Registro de alimentación</div>
        <p class="hint">Desayuno, almuerzo, cena y snacks clasificados por tipo y calorías.</p>
        <span class="cta">Ir a alimentación</span>
      </a>

      <a routerLink="/water" class="card entry lift">
        <div class="head"><lucide-icon [img]="DropletsIcon"></lucide-icon> Agua</div>
        <p class="hint">Registra vasos/botellas y cumple tu meta diaria.</p>
        <span class="cta">Ir a agua</span>
      </a>
    </section>


    <!-- NUEVO: Panel inferior /panel -->
    <section class="card panel-alimentation">
      <div class="panel-row">
        <div class="panel-text">
          <div class="panel-title">Panel de alimentación</div>
          <p class="panel-sub">Visualiza tu progreso, histogramas y tendencias.</p>
        </div>
        <a routerLink="/panel" class="btn panel-cta">
          Ir al panel
          <lucide-icon [img]="ChevronRightIcon"></lucide-icon>
        </a>
      </div>
    </section>
  </div>

  <p class="err" *ngIf="err()">{{ err() }}</p>
</section>

<ng-template #skel>
  <div class="container loading">Cargando dashboard…</div>
</ng-template>
